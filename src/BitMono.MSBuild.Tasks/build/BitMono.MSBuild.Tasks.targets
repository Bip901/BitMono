<Project TreatAsLocalProperty="TaskFolder;TaskAssembly">

  <PropertyGroup>
    <TaskAssembly Condition="'$(MSBuildRuntimeType)' == 'Full'">$(MSBuildThisFileDirectory)\..\netframework\bitMono.MSBuild.Tasks.dll</TaskAssembly>
    <TaskAssembly Condition="'$(TaskAssembly)' == ''">$(MSBuildThisFileDirectory)\..\netstandard\BitMono.MSBuild.Tasks.dll</TaskAssembly>

    <BitMonoEnabled Condition="'$(BitMonoEnabled)' == ''">true</BitMonoEnabled>
    <BitMonoProtections Condition="'$(BitMonoProtections)' == ''">$(MSBuildProjectDirectory)\protections.json</BitMonoProtections>
    <BitMonoCriticals Condition="'$(BitMonoCriticals)' == ''">$(MSBuildProjectDirectory)\criticals.json</BitMonoCriticals>
    <BitMonoObfuscation Condition="'$(BitMonoObfuscation)' == ''">$(MSBuildProjectDirectory)\obfuscation.json</BitMonoObfuscation>
  </PropertyGroup>

  <UsingTask TaskName="BitMono.MSBuild.Tasks.Protect" AssemblyFile="$(TaskAssembly)" />
  <Target
    Name="RunBitMono"
    AfterTargets="AfterCompile"
    DependsOnTargets="$(BitMonoDependsOn)"
    Condition="Exists(@(IntermediateAssembly)) And $(DesignTimeBuild) != true And $(BitMonoEnabled) == true And ($(Configuration) == 'Release')">
    <Protect TaskAssembly="$(TaskAssembly)"
             AssemblyPath="@(IntermediateAssembly)"
             References="@(ReferencePath)"
             BitMonoEnabled="$(BitMonoEnabled)"
             BitMonoProtections="$(BitMonoProtections)"
             BitMonoCriticals="$(BitMonoCriticals)"
             BitMonoObfuscation="$(BitMonoObfuscation)" />
  </Target>
</Project>